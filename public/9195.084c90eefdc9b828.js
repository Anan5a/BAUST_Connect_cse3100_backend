"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[9195],{9195:(te,w,c)=>{c.r(w),c.d(w,{ChatlistPageModule:()=>ee});var p=c(9808),h=c(4182),l=c(2159),m=c(333),r=c(2096),S=c(5722),v=c(7221),T=c(520),z=c(4376),V=c(1188),C=c(8555);let x=(()=>{class n{constructor(e,i,o,s){this.httpClient=e,this.httpconfig=i,this.storageService=o,this.loaderService=s,this.apiRoot=S.I.apiUrl,this.path="chat",this.csrf="sanctum/csrf-cookie",this.siteRoot=S.I.siteRoot,this.completePath=this.apiRoot+this.path}send(e,i=null){return this.httpClient.post(this.apiRoot+this.path,e).pipe((0,v.K)(this.httpconfig.handleError("send message error occurred")))}receive(e,i=null){return this.httpClient.post(this.apiRoot+"get",e).pipe((0,v.K)(this.httpconfig.handleError("get message error occurred")))}chatList(){return this.httpClient.get(this.apiRoot+this.path).pipe((0,v.K)(this.httpconfig.handleError("get chat list error occurred")))}}return n.\u0275fac=function(e){return new(e||n)(r.LFG(T.eN),r.LFG(z.N),r.LFG(V.V),r.LFG(C.D))},n.\u0275prov=r.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function I(n,t){1&n&&(r.TgZ(0,"ion-list")(1,"ion-item")(2,"h1"),r._uU(3,"NO ITEM FOUND"),r.qZA()()())}function E(n,t){if(1&n&&(r.TgZ(0,"ion-item")(1,"ion-avatar"),r._UZ(2,"img",5),r.qZA(),r.TgZ(3,"ion-label",6)(4,"h2"),r._uU(5),r.qZA(),r.TgZ(6,"h3",7),r._uU(7),r.qZA(),r.TgZ(8,"p",8),r._uU(9),r.qZA()()()),2&n){const e=t.$implicit,i=r.oxw();r.xp6(3),r.MGl("routerLink","/messages/",null==e||null==e.receiver?null:e.receiver.id,""),r.xp6(2),r.Oqu(null==e||null==e.receiver?null:e.receiver.full_name),r.xp6(2),r.Oqu(null==e?null:e.content),r.xp6(2),r.Oqu(i.date2ago(null==e?null:e.created_at))}}let F=(()=>{class n{constructor(e){this.chatService=e}ngOnInit(){this.chatService.chatList().subscribe(e=>{e&&"ok"==e.status&&(this.chats=e.data)})}date2ago(e){let i=Math.floor(Date.now()/1e3-Date.parse(e)/1e3),o=Math.floor(i/31536e3);return o>1?o+"y":(o=Math.floor(i/2592e3),o>1?o+"m":(o=Math.floor(i/86400),o>=1?o+"d":(o=Math.floor(i/3600),o>=1?o+"h":(o=Math.floor(i/60),o>1?o+"m ":Math.floor(i)+"s"))))}}return n.\u0275fac=function(e){return new(e||n)(r.Y36(x))},n.\u0275cmp=r.Xpm({type:n,selectors:[["app-chatlist"]],decls:13,vars:2,consts:[["color","primary"],["slot","start"],["size-lg","4","size-md","4","size-sm","4","size-xl","4","size-xs","12"],[4,"ngIf"],[4,"ngFor","ngForOf"],["src","../../../../assets/shapes.svg"],[3,"routerLink"],[2,"color","darkgray"],[2,"color","lightgray"]],template:function(e,i){1&e&&(r.TgZ(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-buttons",1),r._UZ(3,"ion-menu-button"),r.qZA(),r.TgZ(4,"ion-title"),r._uU(5,"messages"),r.qZA()()(),r.TgZ(6,"ion-content")(7,"ion-grid")(8,"ion-row")(9,"ion-col",2),r.YNc(10,I,4,0,"ion-list",3),r.TgZ(11,"ion-list"),r.YNc(12,E,10,4,"ion-item",4),r.qZA()()()()()),2&e&&(r.xp6(10),r.Q6J("ngIf",(null==i.chats?null:i.chats.length)<1),r.xp6(2),r.Q6J("ngForOf",i.chats))},directives:[l.Gu,l.sr,l.Sm,l.fG,l.wd,l.W2,l.jY,l.Nd,l.wI,p.O5,l.q_,l.Ie,p.sg,l.BJ,l.Q$,l.YI,m.rH],styles:[".sender[_ngcontent-%COMP%], .receiver[_ngcontent-%COMP%]{border-radius:10px}"]}),n})();var M=c(7053);function P(n,t){if(1&n&&(r.TgZ(0,"ion-label",9),r._uU(1),r.qZA()),2&n){const e=r.oxw().$implicit;r.xp6(1),r.Oqu(null==e?null:e.content)}}function A(n,t){if(1&n&&(r.TgZ(0,"ion-label",10),r._uU(1),r.qZA()),2&n){const e=r.oxw().$implicit;r.xp6(1),r.Oqu(null==e?null:e.content)}}function L(n,t){if(1&n&&(r.TgZ(0,"ion-item"),r.YNc(1,P,2,1,"ion-label",7),r.YNc(2,A,2,1,"ion-label",8),r.qZA()),2&n){const e=t.$implicit,i=r.oxw();r.xp6(1),r.Q6J("ngIf",e.from==i.from.id),r.xp6(1),r.Q6J("ngIf",e.from==i.receiver.id)}}const B=[{path:"",component:F},{path:":id",component:(()=>{class n{constructor(e,i,o,s,a,u){this.authService=e,this.loaderService=i,this.activeRoute=o,this.router=s,this.fb=a,this.chatService=u,this.messages=[]}ngOnInit(){const e=this.activeRoute.snapshot.paramMap.get("id");this.authService.getProfileFromServer(e).subscribe(i=>{i&&"ok"==i.status&&(this.receiver=i.data.info,this.profile_full_body=i.data)}),this.authService.getProfile().then(i=>{this.from=i}),this.message_box=this.fb.group({content:["",[h.kI.required,h.kI.minLength(4),h.kI.maxLength(249)]]})}send(){var e;console.log(this.from,this.receiver),this.chatService.send({to:this.receiver.id,content:null===(e=this.message_box.value)||void 0===e?void 0:e.content}).subscribe(i=>{"ok"==i.status&&(this.messages.push(i.data),console.log(this.messages),this.message_box.reset())})}receive(){}loadOldMessages(){}}return n.\u0275fac=function(e){return new(e||n)(r.Y36(M.$),r.Y36(C.D),r.Y36(m.gz),r.Y36(m.F0),r.Y36(h.qu),r.Y36(x))},n.\u0275cmp=r.Xpm({type:n,selectors:[["app-chat"]],decls:18,vars:5,consts:[["color","primary"],["slot","start"],["size-lg","4","size-md","3","size-xs","12"],[4,"ngFor","ngForOf"],[3,"formGroup","ngSubmit"],["formControlName","content","placeholder","Type message...","type","text","auto-grow","true"],["type","submit",3,"disabled"],["class","ion-text-end",4,"ngIf"],["class","ion-text-start",4,"ngIf"],[1,"ion-text-end"],[1,"ion-text-start"]],template:function(e,i){1&e&&(r.TgZ(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-buttons",1),r._UZ(3,"ion-menu-button"),r.qZA(),r.TgZ(4,"ion-title"),r._uU(5),r.qZA()()(),r.TgZ(6,"ion-content")(7,"ion-grid")(8,"ion-row"),r._UZ(9,"ion-col",2),r.TgZ(10,"ion-col")(11,"ion-list"),r.YNc(12,L,3,2,"ion-item",3),r.qZA(),r.TgZ(13,"form",4),r.NdJ("ngSubmit",function(){return i.send()}),r.TgZ(14,"ion-item"),r._UZ(15,"ion-textarea",5),r.TgZ(16,"ion-button",6),r._uU(17,"Send"),r.qZA()()()()()()()),2&e&&(r.xp6(5),r.AsE("to: ",null==i.receiver?null:i.receiver.full_name,"[",null==i.receiver?null:i.receiver.student_id,"]"),r.xp6(7),r.Q6J("ngForOf",i.messages),r.xp6(1),r.Q6J("formGroup",i.message_box),r.xp6(3),r.Q6J("disabled",!i.message_box.valid))},directives:[l.Gu,l.sr,l.Sm,l.fG,l.wd,l.W2,l.jY,l.Nd,l.wI,l.q_,p.sg,l.Ie,p.O5,l.Q$,h._Y,h.JL,h.sg,l.g2,l.j9,h.JJ,h.u,l.YG],styles:["ion-textarea[_ngcontent-%COMP%]{max-height:70px}cdk-virtual-scroll-viewport[_ngcontent-%COMP%]{height:90%;width:100%}.fixed-outside[_ngcontent-%COMP%]{position:absolute;bottom:0;color:#fff;width:100%;height:120px;text-align:center}.has-bottom[_ngcontent-%COMP%]   .scroll[_ngcontent-%COMP%]{padding-bottom:120px!important}.button-circle[_ngcontent-%COMP%]{width:50px!important;height:50px!important;border-radius:50%!important}ion-content[_ngcontent-%COMP%]{--padding-top: 10%;--background: url(https://images.unsplash.com/photo-1536431311719-398b6704d4cc?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=1234&q=80) 0 0/100% 100% no-repeat}form[_ngcontent-%COMP%]{max-width:500px;align-items:center}ion-list[_ngcontent-%COMP%]{max-width:500px}.input-group[_ngcontent-%COMP%]{background:#fff;border-radius:10px;overflow:hidden;margin-bottom:15px}.errors[_ngcontent-%COMP%]{font-size:small;color:#fff;background:var(--ion-color-danger);padding-left:15px;padding-top:5px;padding-bottom:5px}.white[_ngcontent-%COMP%]{color:#fff}"]}),n})()}];let Z=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=r.oAB({type:n}),n.\u0275inj=r.cJS({imports:[[m.Bz.forChild(B)],m.Bz]}),n})();var j=c(2654);class N extends j.w{constructor(t,e){super()}schedule(t,e=0){return this}}class b extends N{constructor(t,e){super(t,e),this.scheduler=t,this.work=e,this.pending=!1}schedule(t,e=0){if(this.closed)return this;this.state=t;const i=this.id,o=this.scheduler;return null!=i&&(this.id=this.recycleAsyncId(o,i,e)),this.pending=!0,this.delay=e,this.id=this.id||this.requestAsyncId(o,this.id,e),this}requestAsyncId(t,e,i=0){return setInterval(t.flush.bind(t,this),i)}recycleAsyncId(t,e,i=0){if(null!==i&&this.delay===i&&!1===this.pending)return e;clearInterval(e)}execute(t,e){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const i=this._execute(t,e);if(i)return i;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(t,e){let o,i=!1;try{this.work(t)}catch(s){i=!0,o=!!s&&s||new Error(s)}if(i)return this.unsubscribe(),o}_unsubscribe(){const t=this.id,e=this.scheduler,i=e.actions,o=i.indexOf(this);this.work=null,this.state=null,this.pending=!1,this.scheduler=null,-1!==o&&i.splice(o,1),null!=t&&(this.id=this.recycleAsyncId(e,t,null)),this.delay=null}}let R=(()=>{class n{constructor(e,i=n.now){this.SchedulerAction=e,this.now=i}schedule(e,i=0,o){return new this.SchedulerAction(this,e).schedule(o,i)}}return n.now=()=>Date.now(),n})();class g extends R{constructor(t,e=R.now){super(t,()=>g.delegate&&g.delegate!==this?g.delegate.now():e()),this.actions=[],this.active=!1,this.scheduled=void 0}schedule(t,e=0,i){return g.delegate&&g.delegate!==this?g.delegate.schedule(t,e,i):super.schedule(t,e,i)}flush(t){const{actions:e}=this;if(this.active)return void e.push(t);let i;this.active=!0;do{if(i=t.execute(t.state,t.delay))break}while(t=e.shift());if(this.active=!1,i){for(;t=e.shift();)t.unsubscribe();throw i}}}new class W extends g{flush(t){this.active=!0,this.scheduled=void 0;const{actions:e}=this;let i,o=-1,s=e.length;t=t||e.shift();do{if(i=t.execute(t.state,t.delay))break}while(++o<s&&(t=e.shift()));if(this.active=!1,i){for(;++o<s&&(t=e.shift());)t.unsubscribe();throw i}}}(class U extends b{constructor(t,e){super(t,e),this.scheduler=t,this.work=e}requestAsyncId(t,e,i=0){return null!==i&&i>0?super.requestAsyncId(t,e,i):(t.actions.push(this),t.scheduled||(t.scheduled=requestAnimationFrame(()=>t.flush(null))))}recycleAsyncId(t,e,i=0){if(null!==i&&i>0||null===i&&this.delay>0)return super.recycleAsyncId(t,e,i);0===t.actions.length&&(cancelAnimationFrame(e),t.scheduled=void 0)}});let G=1;const H=Promise.resolve(),_={};function y(n){return n in _&&(delete _[n],!0)}const D={setImmediate(n){const t=G++;return _[t]=!0,H.then(()=>y(t)&&n()),t},clearImmediate(n){y(n)}};new class J extends g{flush(t){this.active=!0,this.scheduled=void 0;const{actions:e}=this;let i,o=-1,s=e.length;t=t||e.shift();do{if(i=t.execute(t.state,t.delay))break}while(++o<s&&(t=e.shift()));if(this.active=!1,i){for(;++o<s&&(t=e.shift());)t.unsubscribe();throw i}}}(class q extends b{constructor(t,e){super(t,e),this.scheduler=t,this.work=e}requestAsyncId(t,e,i=0){return null!==i&&i>0?super.requestAsyncId(t,e,i):(t.actions.push(this),t.scheduled||(t.scheduled=D.setImmediate(t.flush.bind(t,null))))}recycleAsyncId(t,e,i=0){if(null!==i&&i>0||null===i&&this.delay>0)return super.recycleAsyncId(t,e,i);0===t.actions.length&&(D.clearImmediate(e),t.scheduled=void 0)}});let k=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=r.oAB({type:n}),n.\u0275inj=r.cJS({}),n})(),O=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=r.oAB({type:n}),n.\u0275inj=r.cJS({}),n})(),X=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=r.oAB({type:n}),n.\u0275inj=r.cJS({imports:[[k,O],k,O]}),n})(),ee=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=r.oAB({type:n}),n.\u0275inj=r.cJS({imports:[[p.ez,h.u5,l.Pc,h.UX,Z,X]]}),n})()}}]);